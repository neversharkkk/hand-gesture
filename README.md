# V - 视觉音乐合成器

## 概述

V是一个基于计算机视觉的实时音乐合成器，通过摄像头捕捉手势和颜色来控制音乐生成。支持多种模式，包括合成器模式、采样器模式和TR-808音序器模式。

## 功能特性

### 模式列表

| 模式 | 按键 | 功能 |
|------|------|------|
| 模式1 | 1 | 基础合成器 |
| 模式2 | 2 | 和声模式 |
| 模式3 | 3 | 琶音器模式 |
| 模式4 | 4 | 粒子合成器 |
| 模式5 | 5 | 氛围合成器 |
| **模式6** | 6 | TR-808音序器 |
| 模式7 | 7 | 演示模式 |

### TR-808音序器模式（模式6）

#### 核心功能

- **16步音序器**：经典鼓机风格
- **12种声音库**：TR-808、TR-909、LinnDrum、SP-1200、CR-78、DMX、MMT8、TR-707、SR-16、DR-660、R-8、KPR-77
- **16种节奏风格**：Classic、HipHop、House、Techno、Breakbeat、Dubstep、Jungle、Ambient、Trap、Drill、Garage、Footwork、Afrobeat、Samba、Reggaeton

#### 鼓音列表（15种）

| 音色 | 缩写 | 特点 |
|------|------|------|
| 底鼓 | KD | 多层频率下滑、次谐波 |
| 军鼓 | SD | 多层音调、带通噪声 |
| 拍手 | CP | 多级带通滤波 |
| 闭镲 | CH | 8层方波叠加 |
| 开镲 | OH | 开放踩镲 |
| 高通 | HT | 频率下滑+泛音 |
| 中通 | MT | 中音通鼓 |
| 低通 | LT | 低音通鼓 |
| 边击 | RS | 多层频率 |
| 牛铃 | CB | 3层失谐方波 |
| 克拉维 | CL | 双频率层 |
| 沙锤 | MA | 高通滤波噪声 |
| 高康加 | CG | 康加鼓高频 |
| 低康加 | CL | 康加鼓低频 |
| 镲片 | CY | 噪声+shimmer |

### 手势控制

| 手势参数 | 映射方式 | 控制内容 |
|----------|----------|----------|
| Y位置 | `y^1.3` 非线性曲线 | 音色参数 |
| X位置 | `x^0.9` 平滑曲线 | BPM (55-230) |
| 面积 | 对数映射 | 摇摆感、变奏强度 |
| X+Y+面积 | 3x3网格+面积微调 | 风格切换 |
| 手指数量 | 线性映射 | 混响、延迟、滤波 |

### 颜色控制

#### 颜色敏感度

- 使用前5个颜色样本取平均
- 非线性放大：`saturation^0.7`, `brightness^0.8`
- 色相影响音高偏移（±0.2）

#### 颜色到声音库映射

| 色相范围 | 声音库 | 氛围 |
|----------|--------|------|
| 0°-30° | TR-808 | 温暖 |
| 30°-60° | TR-909 | 明亮 |
| 60°-90° | LinnDrum | 快乐 |
| 90°-120° | SP-1200 | 暗黑 |
| 120°-150° | CR-78 | 自然 |
| 150°-180° | DMX | 放克 |
| 180°-210° | MMT8 | 神秘 |
| 210°-240° | TR-707 | 工业 |
| 240°-270° | SR-16 | 摇滚 |
| 270°-300° | DR-660 | 爵士 |
| 300°-330° | R-8 | 异域 |
| 330°-360° | KPR-77 | 梦幻 |

#### 颜色到基底旋律映射

| 颜色区域 | 基底音符 |
|----------|----------|
| 红-橙 | C, D#, E, G, A#, C3 |
| 黄-黄绿 | E, F#, G#, A#, C#4, D#4 |
| 绿-青绿 | A, C, D, E, G, A3 |
| 青-蓝 | G#, B, C#, D#, F#, G#3 |
| 蓝-紫 | G, A#, B, C#, E, F#3 |
| 紫-红 | B, D, E, F#, A, B3 |

## 音频处理链

### 完整效果链（14阶段）

```
混音 → 增益(1.3x) → 动态扩展 → 多段压缩 → 6段EQ → 低频增强 → 低通滤波 → 高通滤波 → 释放延长 → 失真 → 合唱 → 镶边 → 限幅 → 延迟 → 混响
```

### 滤波器

| 滤波器 | 类型 | 参数 |
|--------|------|------|
| 参数均衡器 | 超低频提升 | 40Hz, +35% |
| 参数均衡器 | 低频提升 | 80Hz, +28% |
| 参数均衡器 | 中低频提升 | 200Hz, +18% |
| 参数均衡器 | 中频提升 | 500Hz-1kHz, +12% |
| 参数均衡器 | 中高频提升 | 2-4kHz, +8% |
| 参数均衡器 | 高频提升 | 8kHz, +12% |
| 低通滤波器 | 4阶IIR | 截止频率可调 |
| 高通滤波器 | 1阶IIR | 15Hz截止 |

### 效果器

| 效果器 | 参数 |
|--------|------|
| 动态扩展器 | 阈值0.15, 扩展比1.5x |
| 多段压缩 | 低频3:1, 高频2.5:1, 软拐点 |
| 低频增强器 | 二次谐波, +20% |
| 释放延长器 | 300-700ms可调 |
| 失真 | 软饱和, wet/dry 30%/70% |
| 合唱 | 深度1ms, 速率0.5Hz |
| 镶边 | 深度0.5ms, 速率2Hz |
| 延迟 | 时间可调, 反馈35% |
| 混响 | 4条延迟线, 衰减可调 |

## 技术规格

### 音频参数

| 参数 | 值 |
|------|-----|
| 采样率 | 48000 Hz |
| 缓冲区 | 1024 samples |
| 数据类型 | float32 |
| 限制范围 | ±0.92 |

### 音量平衡

| 鼓音 | 音量 |
|------|------|
| 底鼓 | 110% |
| 军鼓 | 95% |
| 拍手 | 80% |
| 通鼓 | 70-75% |
| 其他 | 40-65% |

## 运行方式

```bash
python main.py
```

### 按键操作

| 按键 | 功能 |
|------|------|
| 1-7 | 切换模式 |
| q/x | 退出程序 |
| 空格 | 暂停/继续 |

## 依赖

- Python 3.x
- OpenCV (cv2)
- NumPy
- sounddevice

## 版本历史

### v1.0.0 (当前版本)

- TR-808风格16步音序器
- 12种经典鼓机声音库
- 16种节奏风格
- 高敏感度颜色控制
- 专业音频处理链
- 6段参数均衡器
- 多种效果器（合唱、镶边、延迟、混响）
- 动态扩展器和多段压缩
- 平滑参数过渡
